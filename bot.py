import asyncio
from aiogram import Bot, Dispatcher
from aiogram.types import Message, ReplyKeyboardMarkup, KeyboardButton
from aiogram.types import ReplyKeyboardRemove
from aiogram.filters import Command

TOKEN = "8639759591:AAE-ZwvEAgMd8GWaUYy0LRo4dn2G0hsLvLk"

bot = Bot(token=TOKEN)
dp = Dispatcher()

ABOUT_TEXT = (
    "üè¢ *–û –±—Ä–µ–Ω–¥–µ*\n\n"
    "–ü–ê–û ¬´–†–æ—Å—Ç–µ–ª–µ–∫–æ–º¬ª ‚Äî –∫—Ä—É–ø–Ω–µ–π—à–∏–π –≤ –†–æ—Å—Å–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —É—Å–ª—É–≥ "
    "–∏ —Ä–µ—à–µ–Ω–∏–π, –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π –≤–æ –≤—Å–µ—Ö —Å–µ–≥–º–µ–Ω—Ç–∞—Ö —Ä—ã–Ω–∫–∞ –∏ –æ—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏–π –º–∏–ª–ª–∏–æ–Ω—ã "
    "–¥–æ–º–æ—Ö–æ–∑—è–π—Å—Ç–≤, –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏ —á–∞—Å—Ç–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π.\n\n"

    "üìö *–£—Å–ª—É–≥–∞ ¬´–†–æ—Å—Ç–µ–ª–µ–∫–æ–º –õ–∏—Ü–µ–π¬ª* ‚Äî –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π "
    "–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∏ —Ä–∞–∑–≤–∏–≤–∞—é—â–µ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è —à–∫–æ–ª—å–Ω–∏–∫–æ–≤ 1‚Äì11 –∫–ª–∞—Å—Å–æ–≤. "
    "–£—Å–ª—É–≥—É –ø–æ –≤—ã–≥–æ–¥–Ω–æ–π —Ü–µ–Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –ø–∞—Ä—Ç–Ω—ë—Ä—ã –†–æ—Å—Ç–µ–ª–µ–∫–æ–º–∞ ‚Äî –ª–∏–¥–µ—Ä—ã —Ä—ã–Ω–∫–∞ "
    "–æ–Ω–ª–∞–π–Ω-–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è.\n\n"

    "üéì *–ß—Ç–æ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç ¬´–†–æ—Å—Ç–µ–ª–µ–∫–æ–º –õ–∏—Ü–µ–π¬ª:*\n"
    "‚Ä¢ –ë–ª–∏—Ü-–∫—É—Ä—Å—ã —Å —É—Ä–æ–∫–∞–º–∏ —à–∫–æ–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã\n"
    "‚Ä¢ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –û–ì–≠ –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ –∏ —Ä—É—Å—Å–∫–æ–º—É —è–∑—ã–∫—É\n"
    "‚Ä¢ –û–±—É—á–∞—é—â–∏–µ —Ç—Ä–µ–Ω–∞–∂—ë—Ä—ã –ø–æ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º—É —è–∑—ã–∫—É\n"
    "‚Ä¢ –î–ª—è –º–ª–∞–¥—à–∏—Ö —à–∫–æ–ª—å–Ω–∏–∫–æ–≤ ‚Äî —É—Ä–æ–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –æ–±—É—á–∞—é—â–∏—Ö –º—É–ª—å—Ç—Ñ–∏–ª—å–º–æ–≤ "
    "–∏ —Ä–∞–∑–≤–∏–≤–∞—é—â–∏—Ö —Ç—Ä–µ–Ω–∞–∂—ë—Ä–æ–≤\n"
    "‚Ä¢ –ü—Ä–æ–≥—Ä–∞–º–º—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –§–ì–û–°\n\n"

    "üåç *–ú–∏—Å—Å–∏—è –∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã –†–æ—Å—Ç–µ–ª–µ–∫–æ–º–∞*\n\n"
    "üîπ *–†–∞–≤–Ω—ã–µ —Ü–∏—Ñ—Ä–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏* ‚Äî —Ä–∞–∑–≤–∏—Ç–∏–µ —Å–≤—è–∑–∏ –∏ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ "
    "–≤–æ –≤—Å–µ—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö —Å—Ç—Ä–∞–Ω—ã, –≤–∫–ª—é—á–∞—è —É–¥–∞–ª—ë–Ω–Ω—ã–µ –∏ –º–∞–ª–æ–Ω–∞—Å–µ–ª—ë–Ω–Ω—ã–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏.\n\n"
    "üîπ *–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∏ –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å* ‚Äî —á–µ—Å—Ç–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥ –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∏ –ø–∞—Ä—Ç–Ω—ë—Ä–∞–º–∏, "
    "—Å–æ—Ü–∏–∞–ª—å–Ω–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å, –±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –≤–æ–ª–æ–Ω—Ç—ë—Ä—Å—Ç–≤–æ.\n\n"
    "üîπ *–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–Ω–æ—Å—Ç—å* ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥–æ–≤—ã—Ö —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è "
    "–∫–∞—á–µ—Å—Ç–≤–∞ –∂–∏–∑–Ω–∏ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç–∏ –æ–±—â–µ—Å—Ç–≤–∞.\n\n"
    "üîπ *–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ* ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–∞–º–º, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –Ω–∞ —É—Å—Ç–æ–π—á–∏–≤–æ–µ "
    "—Å–æ—Ü–∏–∞–ª—å–Ω–æ-—ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ —Å—Ç—Ä–∞–Ω—ã.\n\n"
    "üîπ *–í–∫–ª–∞–¥ –≤ —Ü–µ–ª–∏ –û–û–ù* ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¶–µ–ª–µ–π —É—Å—Ç–æ–π—á–∏–≤–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è –û–û–ù, –≤–∫–ª—é—á–∞—è "
    "–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, –∏–Ω–Ω–æ–≤–∞—Ü–∏–∏, —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–µ—Ä–∞–≤–µ–Ω—Å—Ç–≤–∞ –∏ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —Ä–æ—Å—Ç."
)

questions = [
    {
        "question": "1Ô∏è‚É£ –°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç 7 √ó 8?",
        "options": ["54", "56", "64"],
        "correct": 1
    },
    {
        "question": "2Ô∏è‚É£ –ö–∞–∫–∞—è –ø–ª–∞–Ω–µ—Ç–∞ –°–æ–ª–Ω–µ—á–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Å–∞–º–∞—è –±–æ–ª—å—à–∞—è?",
        "options": ["–ó–µ–º–ª—è", "–°–∞—Ç—É—Ä–Ω", "–Æ–ø–∏—Ç–µ—Ä"],
        "correct": 2
    },
    {
        "question": "3Ô∏è‚É£ –ö–∞–∫–æ–π –≥–∞–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –¥—ã—Ö–∞–Ω–∏—è —á–µ–ª–æ–≤–µ–∫–∞?",
        "options": ["–£–≥–ª–µ–∫–∏—Å–ª—ã–π –≥–∞–∑", "–ö–∏—Å–ª–æ—Ä–æ–¥", "–ê–∑–æ—Ç"],
        "correct": 1
    },
    {
        "question": "4Ô∏è‚É£ –í –∫–∞–∫–æ–º –≥–æ–¥—É –Ω–∞—á–∞–ª–∞—Å—å –í—Ç–æ—Ä–∞—è –º–∏—Ä–æ–≤–∞—è –≤–æ–π–Ω–∞?",
        "options": ["1939", "1941", "1945"],
        "correct": 0
    },
    {
        "question": "5Ô∏è‚É£ –ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞—É–∫–∞ –æ –∂–∏–≤—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–º–∞—Ö?",
        "options": ["–§–∏–∑–∏–∫–∞", "–•–∏–º–∏—è", "–ë–∏–æ–ª–æ–≥–∏—è"],
        "correct": 2
    },
    {
        "question": "6Ô∏è‚É£ –°–∫–æ–ª—å–∫–æ –º–∞—Ç–µ—Ä–∏–∫–æ–≤ –Ω–∞ –ó–µ–º–ª–µ?",
        "options": ["5", "6", "7"],
        "correct": 2
    },
    {
        "question": "7Ô∏è‚É£ –ö–∞–∫–æ–π –ø–∞–¥–µ–∂ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã ¬´–∫–µ–º? —á–µ–º?¬ª?",
        "options": ["–¢–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–π", "–†–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π", "–î–∞—Ç–µ–ª—å–Ω—ã–π"],
        "correct": 0
    },
    {
        "question": "8Ô∏è‚É£ –ö–∞–∫–∞—è –µ–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è —Å–∏–ª—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ñ–∏–∑–∏–∫–µ?",
        "options": ["–í–∞—Ç—Ç", "–ü–∞—Å–∫–∞–ª—å", "–ù—å—é—Ç–æ–Ω"],
        "correct": 2
    },
    {
        "question": "9Ô∏è‚É£ –ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ ¬´–í–æ–π–Ω–∞ –∏ –º–∏—Ä¬ª?",
        "options": ["–§.–ú. –î–æ—Å—Ç–æ–µ–≤—Å–∫–∏–π", "–õ.–ù. –¢–æ–ª—Å—Ç–æ–π", "–ê.–°. –ü—É—à–∫–∏–Ω"],
        "correct": 1
    },
    {
        "question": "üîü –ö–∞–∫–æ–µ –≤–µ—â–µ—Å—Ç–≤–æ –∏–º–µ–µ—Ç —Ö–∏–º–∏—á–µ—Å–∫—É—é —Ñ–æ—Ä–º—É–ª—É H‚ÇÇO?",
        "options": ["–í–æ–¥–æ—Ä–æ–¥", "–ö–∏—Å–ª–æ—Ä–æ–¥", "–í–æ–¥–∞"],
        "correct": 2
    },
    {
        "question": "1Ô∏è‚É£1Ô∏è‚É£ –ö–∞–∫–æ–π –æ—Ä–≥–∞–Ω –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ø–µ—Ä–µ–∫–∞—á–∏–≤–∞–Ω–∏–µ –∫—Ä–æ–≤–∏ –≤ –æ—Ä–≥–∞–Ω–∏–∑–º–µ —á–µ–ª–æ–≤–µ–∫–∞?",
        "options": ["–õ—ë–≥–∫–∏–µ", "–°–µ—Ä–¥—Ü–µ", "–ü–µ—á–µ–Ω—å"],
        "correct": 1
    },
    {
        "question": "1Ô∏è‚É£2Ô∏è‚É£ –ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–∞–º–∞—è –¥–ª–∏–Ω–Ω–∞—è —Ä–µ–∫–∞ –≤ –º–∏—Ä–µ?",
        "options": ["–ê–º–∞–∑–æ–Ω–∫–∞", "–ù–∏–ª", "–Ø–Ω—Ü–∑—ã"],
        "correct": 1
    }
]

user_states = {}


async def send_question(message: Message, user_id: int):
    state = user_states[user_id]
    q = questions[state["current"]]

    keyboard = ReplyKeyboardMarkup(
        keyboard=[
            [KeyboardButton(text=option)] for option in q["options"]
        ],
        resize_keyboard=True
    )

    await message.answer(q["question"], reply_markup=keyboard)


# –ö–Ω–æ–ø–∫–∏
main_keyboard = ReplyKeyboardMarkup(
    keyboard=[
        [KeyboardButton(text="–û –ø—Ä–æ–µ–∫—Ç–µ")],
        [KeyboardButton(text="–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç")]
    ],
    resize_keyboard=True
)

@dp.message(Command("start"))
async def start(message: Message):
    await message.answer(
        "–ü—Ä–∏–≤–µ—Ç! üëã\n–í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ:",
        reply_markup=main_keyboard
    )

@dp.message(lambda message: message.text == "–û –ø—Ä–æ–µ–∫—Ç–µ")
async def about_project(message: Message):
    await message.answer(
        ABOUT_TEXT,
        parse_mode="Markdown"
    )

@dp.message(lambda message: message.text == "–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç")
async def start_test(message: Message):
    user_states[message.from_user.id] = {
        "current": 0,
        "score": 0
    }
    await send_question(message, message.from_user.id)

@dp.message()
async def handle_answer(message: Message):
    user_id = message.from_user.id

    if user_id not in user_states:
        return

    state = user_states[user_id]
    current_q = questions[state["current"]]

    if message.text == current_q["options"][current_q["correct"]]:
        state["score"] += 1

    state["current"] += 1

    if state["current"] < len(questions):
        await send_question(message, user_id)
    else:
        result = state["score"]
        del user_states[user_id]

        await message.answer(
            f"‚úÖ –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω!\n"
            f"–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: {result} –∏–∑ {len(questions)}"
            f"–ë–æ–ª—å—à–µ —Ç–µ—Å—Ç–æ–≤ –ø–æ —Ä–∞–∑–Ω—ã–º –ø—Ä–µ–¥–º–µ—Ç–∞–º –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤ –º–æ–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º —Å–∞–π—Ç–µ https://lc.rt.ru/myeducation",
            reply_markup=main_keyboard
        )


async def main():
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())
